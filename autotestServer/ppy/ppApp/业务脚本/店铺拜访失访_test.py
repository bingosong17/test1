# NOTE: Generated By HttpRunner v3.1.3
"""
    概要：
        从私海店铺中选择正常未打卡店铺进行签到
    输入参数：
       "phone": 登陆用户手机号码
       "visitTime": 拜访时间
    输出参数：
        无
    前置接口：
        用户登陆；获取私海列表
"""

from httprunner import HttpRunner, Config, Step, RunTestCase
from yyht.用户中心.api.商铺明细_test import TestCase商铺明细 as 商铺明细
from ppApp.api.失访原因展示_test import TestCase失访原因展示 as 失访原因展示
from ppApp.api.到店打卡签到保存_test import TestCase到店打卡签到保存 as 到店打卡签到保存


class TestCase店铺拜访失访(HttpRunner):
    config = Config("testcase description").verify(False).base_url("${testEnv($business)}").variables(
        **{
            "business": "ppApp",
            "phone": "15168335473",
            "session": "${getSession($business,$phone)}",
            "shopId": "${拼拼公私海店铺生成个未拜访的店铺id($phone,0)}",
        })

    teststeps = [
        Step(
            RunTestCase("商铺明细").with_variables(
                **{
                    "business": "yyht",
                    "session": "${getSession($business)}",
                    "shopId": "$shopId"
                }
            ).call(商铺明细)
                .export(*["longitude", "latitude"])
                .teardown_hook("${sleep_N_secs(1)}")
        ),
        Step(
            RunTestCase("失访原因展示").call(失访原因展示)
                .export(*["missVisitReason"])
                .teardown_hook("${sleep_N_secs(1)}")
        ),
        Step(
            RunTestCase("到店打卡签到保存").with_variables(
                **{
                    "unnormal": 1,
                    "remarks": "测试失访打卡",
                    "exceptionType": "$missVisitReason",
                }
            ).call(到店打卡签到保存)
                .teardown_hook("${sleep_N_secs(1)}")
        ),
    ]


if __name__ == "__main__":
    TestCase店铺拜访失访().test_start()
