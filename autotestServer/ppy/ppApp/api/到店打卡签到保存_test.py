# NOTE: Generated By HttpRunner v3.1.4
"""
    概要：
        到店打卡签到保存
    输入参数：
        "distance": 打卡距离
        "picUrls": 签到照片地址,可以支持多张
        "shopId": shopId
        "signLatitude": 纬度
        "signLongitude": 经度
        "signPosition": 签到地点,同照片上水印地址
        "unnormal": 是否异常,0 正常到店打卡 1 失访上报
        "signType": 拜访对象类型 1 合作店铺 2 潜在店铺 3 合作供应商 4 潜在供应商
        "remarks": 备注,失访上报填写失访说明
        "exceptionType": 异常类型,失访上报原因
    输出参数：
        无
    前置接口：
        无
"""


from httprunner import HttpRunner, Config, Step, RunRequest, RunTestCase


class TestCase到店打卡签到保存(HttpRunner):

    config = Config("到店打卡签到保存").verify(False).base_url("${testEnv($business)}").variables(
        **{
            "business": "ppApp",
            "phone": "15757113586",
            "session": "${getSession($business,$phone)}",
            "distance": 17237,
            "picUrls": [
                "https://images.alpha.pinpianyi.cn/images/face/yypp/93c4ff1d7a7f4065832969df33c0dbc0.png"
            ],
            "shopId": 1106,
            "signLatitude": 30.203846299913195,
            "signLongitude": 120.26027723524305,
            "signPosition": "浙江省杭州市萧山区金一路靠近中港电子商务园",
            "unnormal": 0,
            "signType": 1,
            "remarks": "11",
            "exceptionType": "",
        }).export(*["signId"])

    teststeps = [
        Step(
            RunRequest("/ppy-pinpin/visitRecord/saveSignIn")
            .post("/visitRecord/saveSignIn")
            .with_headers(
                **{
                    "Accept": "*/*",
                    "channel": "app",
                    "appname": "",
                    "Accept-Language": "zh-cn",
                    "Accept-Encoding": "gzip, deflate",
                    "platform": "ios",
                    "Content-Type": "application/json",
                    "sessionid": "$session",
                    "deviceid": "1F8ED797-D036-4BA3-BEAA-A176B0E08BD6",
                    "Content-Length": "310",
                    "User-Agent": "Pinpin/3.8.1 CFNetwork/889.9 Darwin/17.2.0",
                    "appchannel": "appstore",
                    "servicename": "NEW-PP",
                    "Connection": "keep-alive",
                }
            )
            .with_json(
                {
                    "distance": "$distance",
                    "picUrls": "$picUrls",
                    "shopId": "$shopId",
                    "signLatitude": "$signLatitude",
                    "signLongitude": "$signLongitude",
                    "signPosition": "$signPosition",
                    "unnormal": "$unnormal",
                    "signType": "$signType",
                    "remarks": "$remarks",
                    "exceptionType": "$exceptionType",
                }
            ).extract()
            .with_jmespath("body.body.signId", "signId")
            .validate()
            .assert_equal("status_code", 200)
            .assert_equal("body.statusCode", 2000)
        ),
    ]


if __name__ == "__main__":
    TestCase到店打卡签到保存().test_start()
"""
response:
{
	"statusCode": 2000,
	"msg": null,
	"traceMsg": "traceId: null",
	"timestamp": 1603680187,
	"signType": null,
	"sign": null,
	"body": {
		"signId": 3633470,
		"signTime": "10:43"
	}
}
"""