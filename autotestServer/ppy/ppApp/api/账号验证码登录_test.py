# NOTE: Generated By HttpRunner v3.1.4
"""
    概要：
        账号验证码登录
    输入参数：
        "phone": 拼拼登录手机号
        "smsCaptcha": 拼拼登录验证码
    输出参数：
        "session":登录凭证
    前置接口：
        发送验证码
"""


from httprunner import HttpRunner, Config, Step, RunRequest, RunTestCase


class TestCase账号验证码登录(HttpRunner):

    config = Config("账号验证码登录").verify(False).base_url("${testEnv($business)}").variables(
        **{
            "business": "",
            "session": "",
            "phone": "15869038912",
            "smsCaptcha": "0000"
        }).export(*["session"])

    teststeps = [
        Step(
            RunRequest("/ppy-pinpin/user/account/smsLogin")
            .get("/user/account/smsLogin")
            .with_params(**{"account": "$phone", "smsCaptcha": "$smsCaptcha"})
            .with_headers(
                **{
                    "serviceName": "NEW-PP",
                    "deviceId": "3834e10b-cb2a-34c6-85f2-2ae3b365eb14",
                    "Connection": "Keep-Alive",
                    "Accept-Encoding": "gzip",
                    "User-Agent": "okhttp/3.12.1",
                    "Content-Type": "application/json",
                    "Accept-Language": "zh-CN,zh;q=0.8",
                }
            ).extract()
            .with_jmespath("body.body.sessionId", "session")
            .validate()
            .assert_equal("status_code", 200)
            .assert_equal("body.statusCode", 2000)
        ),
    ]


if __name__ == "__main__":
    TestCase账号验证码登录().test_start()
"""
response:
{
	"statusCode": 2000,
	"msg": null,
	"traceMsg": "traceId: null",
	"timestamp": 1600138463,
	"signType": null,
	"sign": null,
	"body": {
		"sessionId": "Qau3wU2dJpeO5ShigUYeAHh9Iz2DncVXrApODx5K8iSbous2ZcHuipIzVl5T8cp+2UUugfz1xhDMWQaa+CkC3wIVk3Td3G8N4gkmxWxEOmC413/FEZiEUF/Xn/fw2K//UkH0lM0PeL8PiyLtwZocWQ==",
		"key": "cb1fcb33da244b76a69214b0676c3cb8",
		"phone": "18268186428",
		"name": "杨涛",
		"departmentFlag": 1,
		"roleId": 123,
		"id": 9
		"businessLine": 0,
		"satelliteDashboardH5Url": "https://h5.pinpianyi.cn/h5pinpin/index.html#/dashboard",
		"isSatelliteBD": false
	}
}
"""